<!-- quickView -->
<div class="modal fullRight fade modal-quick-view" id="quickView">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="tf-quick-view-image">
        <div class="wrap-quick-view wrapper-scroll-quickview" id="quickViewImagesContainer">
          <!-- Images will be populated dynamically -->
        </div>
      </div>
      <div class="wrap">
        <div class="header">
          <h5 class="title">Quick View</h5>
          <span class="icon-close icon-close-popup" data-bs-dismiss="modal"></span>
        </div>
        <div class="tf-product-info-list">
          <div class="tf-product-info-heading">
            <div class="tf-product-info-name">
              <div class="text text-btn-uppercase" id="quickViewCategory"></div>
              <h3 class="name" id="quickViewTitle"></h3>
              <div class="sub">
                <div class="tf-product-info-rate">
                  <div class="list-star" id="quickViewRatingStars">
                    <!-- Stars will be populated -->
                  </div>
                  <div class="text text-caption-1" id="quickViewReviews"></div>
                </div>
                <div class="tf-product-info-sold" id="quickViewStockInfo">
                  <i class="icon icon-lightning"></i>
                  <div class="text text-caption-1"></div>
                </div>
              </div>
            </div>
            <div class="tf-product-info-desc">
              <div class="tf-product-info-price" id="quickViewPriceContainer">
                <!-- Price will be populated -->
              </div>
              <p id="quickViewDescription"></p>
              <div class="tf-product-info-liveview" style="display: none;">
                <i class="icon icon-eye"></i>
                <p class="text-caption-1"><span class="liveview-count">28</span> people are viewing this right now</p>
              </div>
            </div>
          </div>
          <div class="tf-product-info-choose-option">
            <!-- Attributes Section -->
            <div id="quickViewAttributesContainer">
              <!-- Attributes will be populated dynamically -->
            </div>

            <!-- Quantity -->
            <div class="tf-product-info-quantity">
              <div class="title mb_12">Quantity:</div>
              <div class="wg-quantity">
                <span class="btn-quantity btn-decrease">-</span>
                <input class="quantity-product" type="text" name="number" value="1">
                <span class="btn-quantity btn-increase">+</span>
              </div>
            </div>

            <!-- Action Buttons -->
            <div>
              <div class="tf-product-info-by-btn mb_10">
                <a class="btn-style-2 flex-grow-1 text-btn-uppercase fw-6" id="quickViewAddToCart">
                  <span>Add to cart -&nbsp;</span>
                  <span class="tf-qty-price total-price" id="quickViewTotalPrice"></span>
                </a>
                <a href="#compare" data-bs-toggle="offcanvas" aria-controls="compare"
                  class="box-icon hover-tooltip compare btn-icon-action show-compare">
                  <span class="icon icon-gitDiff"></span>
                  <span class="tooltip text-caption-2">Compare</span>
                </a>
                <a href="javascript:void(0);" class="box-icon hover-tooltip text-caption-2 wishlist btn-icon-action">
                  <span class="icon icon-heart"></span>
                  <span class="tooltip text-caption-2">Wishlist</span>
                </a>
              </div>
              <a href="#" class="btn-style-3 text-btn-uppercase" id="quickViewBuyNow">View Full Details</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- /quickView -->

<script>
  // Quick View Modal Handler
  document.addEventListener('DOMContentLoaded', function () {
    const quickViewButtons = document.querySelectorAll('.quickview');

    quickViewButtons.forEach(button => {
      button.addEventListener('click', function (e) {
        e.preventDefault();

        // Parse the complete product data from data attribute
        const productData = JSON.parse(this.getAttribute('data-product'));

        // Call modal population function
        populateQuickViewModal(productData);
      });
    });

    // Quantity controls
    document.addEventListener('click', function (e) {
      if (e.target.classList.contains('btn-increase')) {
        const input = e.target.parentElement.querySelector('.quantity-product');
        const currentQty = parseInt(input.value) || 1;
        input.value = currentQty + 1;
        updateTotalPrice();
      }
      if (e.target.classList.contains('btn-decrease')) {
        const input = e.target.parentElement.querySelector('.quantity-product');
        const currentQty = parseInt(input.value) || 1;
        if (currentQty > 1) {
          input.value = currentQty - 1;
          updateTotalPrice();
        }
      }
    });

    // Update total price when quantity changes
    document.querySelector('.quantity-product')?.addEventListener('change', updateTotalPrice);
  });

  let currentProduct = null;

  function populateQuickViewModal(product) {
    currentProduct = product;

    // Category
    document.getElementById('quickViewCategory').textContent = product.category.name;

    // Title
    document.getElementById('quickViewTitle').textContent = product.title;

    // Description
    document.getElementById('quickViewDescription').textContent = product.description;

    // Rating Stars
    const ratingStars = document.getElementById('quickViewRatingStars');
    const rating = Math.round(product.rating);
    let starsHTML = '';
    for (let i = 0; i < 5; i++) {
      if (i < rating) {
        starsHTML += '<i class="icon icon-star"></i>';
      } else {
        starsHTML += '<i class="icon icon-star" style="opacity: 0.3;"></i>';
      }
    }
    ratingStars.innerHTML = starsHTML;

    // Reviews
    document.getElementById('quickViewReviews').textContent = `(${product.reviewsCount} reviews)`;

    // Stock Info
    const stockInfo = document.getElementById('quickViewStockInfo');
    if (product.inStock) {
      stockInfo.querySelector('.text').innerHTML = `<span class="fw-6">${product.stock}</span> items available`;
    } else {
      stockInfo.querySelector('.text').innerHTML = '<span class="text-danger">Out of Stock</span>';
    }

    // Price
    const priceContainer = document.getElementById('quickViewPriceContainer');
    if (product.isOnSale) {
      priceContainer.innerHTML = `
            <h5 class="price-on-sale font-2">₹${product.price.toLocaleString('en-IN')}</h5>
            <div class="compare-at-price font-2">₹${product.oldPrice.toLocaleString('en-IN')}</div>
            <div class="badges-on-sale text-btn-uppercase">
                -${product.salePercentage}%
            </div>
        `;
    } else {
      priceContainer.innerHTML = `
            <h5 class="price-on-sale font-2">₹${product.price.toLocaleString('en-IN')}</h5>
        `;
    }

    // Images
    const imagesContainer = document.getElementById('quickViewImagesContainer');
    let imagesHTML = '';
    product.images.forEach((image, index) => {
      imagesHTML += `
            <div class="quickView-item item-scroll-quickview">
                <img class="lazyload" data-src="${image}" src="${image}" alt="${product.title}">
            </div>
        `;
    });
    imagesContainer.innerHTML = imagesHTML;

    // Attributes
    const attributesContainer = document.getElementById('quickViewAttributesContainer');
    let attributesHTML = '';

    // Room Type
    if (product.attributes.roomType) {
      attributesHTML += `
            <div class="variant-picker-item">
                <div class="variant-picker-label mb_12">
                    Room Type: <span class="text-title">${product.attributes.roomType}</span>
                </div>
            </div>
        `;
    }

    // Style
    if (product.attributes.style) {
      attributesHTML += `
            <div class="variant-picker-item">
                <div class="variant-picker-label mb_12">
                    Style: <span class="text-title">${product.attributes.style}</span>
                </div>
            </div>
        `;
    }

    // Seating Capacity
    if (product.attributes.seatingCapacity) {
      attributesHTML += `
            <div class="variant-picker-item">
                <div class="variant-picker-label mb_12">
                    Seating: <span class="text-title">${product.attributes.seatingCapacity}</span>
                </div>
            </div>
        `;
    }

    // Material
    if (product.attributes.material) {
      attributesHTML += `
            <div class="variant-picker-item">
                <div class="variant-picker-label mb_12">
                    Material: <span class="text-title">${product.attributes.material}</span>
                </div>
            </div>
        `;
    }

    // Size
    if (product.attributes.sizes) {
      attributesHTML += `
            <div class="variant-picker-item">
                <div class="variant-picker-label mb_12">
                    Size: <span class="text-title">${product.attributes.sizes}</span>
                </div>
            </div>
        `;
    }

    // Brand
    if (product.brand) {
      attributesHTML += `
            <div class="variant-picker-item">
                <div class="variant-picker-label mb_12">
                    Brand: <span class="text-title">${product.brand}</span>
                </div>
            </div>
        `;
    }

    // Subcategories/Tags
    if (product.subcategories && product.subcategories.length > 0) {
      const subcatNames = product.subcategories.map(sub => sub.name).join(', ');
      attributesHTML += `
            <div class="variant-picker-item">
                <div class="variant-picker-label mb_12">
                    Tags: <span class="text-title">${subcatNames}</span>
                </div>
            </div>
        `;
    }

    attributesContainer.innerHTML = attributesHTML;

    // Total Price
    updateTotalPrice();

    // Add to Cart Button
    const addToCartBtn = document.getElementById('quickViewAddToCart');
    if (product.inStock) {
      addToCartBtn.classList.remove('disabled');
      addToCartBtn.style.pointerEvents = 'auto';
      addToCartBtn.dataset.productId = product._id;
    } else {
      addToCartBtn.classList.add('disabled');
      addToCartBtn.style.pointerEvents = 'none';
      addToCartBtn.style.opacity = '0.5';
    }

    // View Full Details Link
    const buyNowBtn = document.getElementById('quickViewBuyNow');
    buyNowBtn.href = `/products/${product.slug}`;

    // Reset quantity to 1
    document.querySelector('.quantity-product').value = 1;
  }

  function updateTotalPrice() {
    if (!currentProduct) return;

    const quantity = parseInt(document.querySelector('.quantity-product').value) || 1;
    const totalPrice = currentProduct.price * quantity;

    document.getElementById('quickViewTotalPrice').textContent = `₹${totalPrice.toLocaleString('en-IN')}`;
  }
</script>